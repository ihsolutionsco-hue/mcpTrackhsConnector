{
  "titulo": "Reporte de Pruebas de Tipos de Usuario - search_units MCP TrackHS",
  "fecha": "2025-10-22",
  "resumen": {
    "total_escenarios": 6,
    "escenarios_exitosos": 2,
    "escenarios_fallidos": 4,
    "problema_principal": "Inconsistencia en validación de tipos de parámetros"
  },
  "escenarios_de_prueba": [
    {
      "nombre": "Usuario básico - Búsqueda simple",
      "descripcion": "Usuario busca propiedades por nombre",
      "parametros": {
        "page": 1,
        "size": 3,
        "search": "villa"
      },
      "tipo_usuario": "Turista",
      "expectativa": "Debería funcionar sin problemas"
    },
    {
      "nombre": "Usuario avanzado - Filtros de características",
      "descripcion": "Usuario busca con filtros específicos de habitaciones",
      "parametros": {
        "page": 1,
        "size": 3,
        "bedrooms": "4",
        "bathrooms": "2"
      },
      "tipo_usuario": "Familia",
      "expectativa": "FALLA - Espera integer pero recibe string"
    },
    {
      "nombre": "Usuario con preferencias - Filtros booleanos",
      "descripcion": "Usuario busca propiedades pet-friendly activas",
      "parametros": {
        "page": 1,
        "size": 3,
        "pets_friendly": "1",
        "is_active": "1"
      },
      "tipo_usuario": "Dueño de mascotas",
      "expectativa": "FALLA - Espera integer pero recibe string"
    },
    {
      "nombre": "Usuario por ubicación",
      "descripcion": "Usuario busca por nodo específico",
      "parametros": {
        "page": 1,
        "size": 3,
        "node_id": "3",
        "search": "Champions Gate"
      },
      "tipo_usuario": "Turista local",
      "expectativa": "Debería funcionar - node_id acepta string"
    },
    {
      "nombre": "Usuario buscando disponibilidad",
      "descripcion": "Usuario busca con fechas específicas",
      "parametros": {
        "page": 1,
        "size": 3,
        "arrival": "2025-11-01",
        "departure": "2025-11-07",
        "is_bookable": "1"
      },
      "tipo_usuario": "Planificador de viajes",
      "expectativa": "FALLA en is_bookable - Espera integer pero recibe string"
    },
    {
      "nombre": "Usuario con rango de habitaciones",
      "descripcion": "Usuario busca con rango mínimo/máximo",
      "parametros": {
        "page": 1,
        "size": 3,
        "min_bedrooms": "3",
        "max_bedrooms": "6"
      },
      "tipo_usuario": "Grupo grande",
      "expectativa": "FALLA - Espera integer pero recibe string"
    }
  ],
  "analisis_tecnico": {
    "problema": "El schema MCP define parámetros numéricos y booleanos como Optional[str] pero el servidor FastMCP los valida como integer",
    "causa_raiz": "Discrepancia entre el schema definido en el código Python y la validación del servidor MCP",
    "impacto": "Los usuarios no pueden usar filtros numéricos o booleanos a través del MCP",
    "parametros_afectados": {
      "Numéricos que deberían aceptar string": [
        "bedrooms",
        "min_bedrooms",
        "max_bedrooms",
        "bathrooms",
        "min_bathrooms",
        "max_bathrooms",
        "calendar_id",
        "role_id"
      ],
      "Booleanos (0/1) que deberían aceptar string": [
        "pets_friendly",
        "allow_unit_rates",
        "computed",
        "inherited",
        "limited",
        "is_bookable",
        "include_descriptions",
        "is_active",
        "events_allowed",
        "smoking_allowed",
        "children_allowed",
        "is_accessible"
      ],
      "IDs que ya aceptan string (correcto)": [
        "node_id",
        "amenity_id",
        "unit_type_id",
        "id"
      ]
    }
  },
  "casos_de_uso_bloqueados": [
    {
      "caso": "Filtrado por número de habitaciones",
      "usuarios_afectados": "Familias, grupos grandes",
      "gravedad": "Alta"
    },
    {
      "caso": "Filtrado por propiedades pet-friendly",
      "usuarios_afectados": "Dueños de mascotas",
      "gravedad": "Alta"
    },
    {
      "caso": "Filtrado por unidades activas/disponibles",
      "usuarios_afectados": "Todos los usuarios",
      "gravedad": "Crítica"
    },
    {
      "caso": "Filtrado por rangos de características",
      "usuarios_afectados": "Usuarios avanzados",
      "gravedad": "Media"
    }
  ],
  "recomendaciones": [
    {
      "prioridad": "Alta",
      "accion": "Actualizar el schema MCP para aceptar tanto string como integer en parámetros numéricos",
      "justificacion": "Permite compatibilidad con diferentes clientes MCP"
    },
    {
      "prioridad": "Alta",
      "accion": "Implementar normalización de tipos en el servidor antes de la validación",
      "justificacion": "Convierte strings a integers automáticamente cuando sea necesario"
    },
    {
      "prioridad": "Media",
      "accion": "Documentar explícitamente los tipos esperados en las descripciones",
      "justificacion": "Ayuda a los desarrolladores a entender los requisitos"
    },
    {
      "prioridad": "Baja",
      "accion": "Agregar mensajes de error más descriptivos",
      "justificacion": "Facilita el debugging para los usuarios"
    }
  ],
  "ejemplos_de_uso": {
    "funciona_actualmente": [
      {
        "descripcion": "Búsqueda básica por texto",
        "codigo": "search_units(page=1, size=3, search=\"villa\")"
      },
      {
        "descripcion": "Filtro por IDs (acepta string)",
        "codigo": "search_units(page=1, size=3, node_id=\"3\")"
      }
    ],
    "no_funciona_actualmente": [
      {
        "descripcion": "Filtro por habitaciones",
        "codigo": "search_units(page=1, size=3, bedrooms=\"4\")",
        "error": "Parameter 'bedrooms' must be one of types [integer, null], got string"
      },
      {
        "descripcion": "Filtro pet-friendly",
        "codigo": "search_units(page=1, size=3, pets_friendly=\"1\")",
        "error": "Parameter 'pets_friendly' must be one of types [integer, null], got string"
      }
    ]
  }
}