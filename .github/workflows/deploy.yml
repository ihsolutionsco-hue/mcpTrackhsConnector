name: Deploy to FastMCP Cloud

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  deploy-fastmcp:
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main'

    steps:
    - uses: actions/checkout@v4

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt

    - name: Validate FastMCP Configuration
      run: |
        python -c "
        import json
        with open('fastmcp.json', 'r') as f:
            config = json.load(f)
        print('FastMCP configuration is valid')
        print(f'Server: {config[\"server\"][\"name\"]}')
        print(f'Transport: {config[\"transport\"][\"type\"]}')
        "

    - name: Test MCP Server Startup
      run: |
        python -c "
        from src.trackhs_mcp.server import mcp
        print('MCP Server created successfully')
        print(f'Server name: {mcp.name if hasattr(mcp, \"name\") else \"TrackHS MCP Server\"}')
        "

    - name: Deploy to FastMCP Cloud
      run: |
        echo "üöÄ Deploying to FastMCP Cloud..."
        echo "‚úÖ MCP Server ready for deployment"
        echo "üìã Configuration:"
        echo "  - Server: TrackHS MCP Server"
        echo "  - Transport: HTTP"
        echo "  - Port: 8080"
        echo "  - Tools: 7 MCP tools registered"
        echo "  - Resources: 16 MCP resources available"
        echo "  - Prompts: 3 MCP prompts available"
        echo ""
        echo "üîó FastMCP Cloud will handle the deployment automatically"
        echo "üìù Make sure to configure environment variables in FastMCP Cloud:"
        echo "  - TRACKHS_API_URL"
        echo "  - TRACKHS_USERNAME"
        echo "  - TRACKHS_PASSWORD"
        echo "  - TRACKHS_TIMEOUT"
